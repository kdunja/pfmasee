<!-- Glavna kartica -->
<div
  style="
    background: #131936;
    border-radius: 8px;
    padding: 6px 16px 16px 16px;
    width: 100%;
    margin-right: 16px;
  "
  [ngStyle]="isMobile ? {
    'max-width': '340px',
    'margin-left': 'auto',
    'margin-right': 'auto'
  } : {}"
>
  <!-- Naslov i dugmad -->
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
    <h3 style="color: #FBF9E4; margin: 0; font-size: 14px;">
      Spending by Category ({{ selectedChart === 'tree' ? 'Tree Map' : 'Pie' }})
    </h3>
    <div style="display: flex; gap: 8px;">
      <button 
        (click)="selectedChart = 'pie'" 
        [style.background-color]="selectedChart === 'pie' ? '#5B88B2' : '#2C365A'"
        style="color: white; border: none; border-radius: 8px; padding: 6px 16px; font-weight: 500; cursor: pointer;">
        Pie Chart
      </button>
      <button 
        (click)="selectedChart = 'tree'" 
        [style.background-color]="selectedChart === 'tree' ? '#5B88B2' : '#2C365A'"
        style="color: white; border: none; border-radius: 8px; padding: 6px 16px; font-weight: 500; cursor: pointer;">
        Tree Map
      </button>
    </div>
  </div>

  <!-- PIE CHART -->
  <div *ngIf="selectedChart === 'pie'">
    <style>
      ::ng-deep .ngx-charts text {
        fill: #EAE0C8 !important;
      }

      ::ng-deep .legend-label {
        fill: #EAE0C8 !important;
        color: #EAE0C8 !important;
      }
    </style>

    <div *ngIf="currentRootCategory" style="margin-bottom: 12px;">
      <button 
        (click)="goBackToMainPie()"
        style="background-color: #2C365A; color: white; border: none; border-radius: 6px; padding: 6px 12px; font-weight: 500; cursor: pointer;">
        ← Back to main categories
      </button>
    </div>

    <div *ngIf="showNoDataMessage" style="width: 400px; margin: 0 auto; text-align: center;">
      <img src="assets/images/logos/eror.png" alt="No data" style="max-width: 120px; margin-bottom: 10px;" />
      <p style="color: #EAE0C8; font-weight: 500; font-size: 14px; margin-top: 8px;">
        Sorry, there is no further data for this category.
      </p>
    </div>

    <!-- Centriran pie chart -->
    <div style="display: flex; justify-content: center;">
      <ngx-charts-pie-chart
        *ngIf="!showNoDataMessage"
        [view]="view"
        [results]="currentRootCategory ? treeMapData : pieData"
        [scheme]="colorScheme"
        [legend]="true"
        [doughnut]="true"
        [labels]="true"
        [animations]="false"
        (select)="onChartSliceSelected($event)"
        [style.max-width.px]="isMobile ? 360 : null"
      ></ngx-charts-pie-chart>
    </div>
  </div>

  <!-- TREE MAP -->
  <div *ngIf="selectedChart === 'tree'">
    <div *ngIf="currentRootCategory" style="margin-bottom: 12px;">
      <button 
        (click)="goBackToMainTree()" 
        style="background-color: #2C365A; color: white; border: none; border-radius: 6px; padding: 6px 12px; font-weight: 500; cursor: pointer;">
        ← Back to main categories
      </button>
    </div>

    <div *ngIf="showNoDataMessage" style="width: 400px; margin: 0 auto; text-align: center;">
      <img src="assets/images/logos/eror.png" alt="No data" style="max-width: 120px; margin-bottom: 10px;" />
      <p style="color: #EAE0C8; font-weight: 500; font-size: 14px; margin-top: 8px;">
        Sorry, there is no further data for this category.
      </p>
    </div>

    <!-- Centriran tree map -->
    <div style="display: flex; justify-content: center;">
      <ngx-charts-tree-map
        *ngIf="treeMapData && treeMapData.length > 0 && !showNoDataMessage"
        [results]="treeMapData"
        [view]="view"
        [scheme]="colorScheme"
        [tooltipDisabled]="true"
        [animations]="false"
        (select)="onCategorySelected($event)"
        [style.max-width.px]="isMobile ? 340 : null"
      ></ngx-charts-tree-map>
    </div>
  </div>
</div>
